{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block titulo_painel %}
   Cadastro da Descrição de Cargos

{% endblock titulo_painel %}


{% block conteudo_painel %}
<form method="post" enctype="multipart/form-data" id="descricaoForm"
      data-areas-url="{% url 'descricao:ajax_load_areas' %}"
      data-sub_familias-url="{% url 'descricao:ajax_load_sub_familias' %}"
      data-ia-url="{% url 'descricao:ajax_load_ia' %}">{% csrf_token %}

    <font size=2>
        <div class="row">
            <div class="col-md-4">
                {{ form.title|as_crispy_field }}
                {# Here you print out any field error #}
                {% if field.errors %}
                    {% for error in field.errors %}
                        <p style="color: red;"> {{ error }} <p>
                     {% endfor %}
                {% endif %}
            </div>
            <div class="col-md-4">
                {{ form.function|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.status|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.board|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.area|as_crispy_field }}
            </div><div class="col-md-4">
                {{ form.title_super|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.family|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.sub_familia|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.level|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.sector|as_crispy_field }}
            </div>
            <div class="col-md-4">
<!--                <center>-->
                    <br>
                    <button onclick="DescricaoIA()" type="button" class="btn btn-primary"><b>  Usar IA</b></button>
<!--                </center>-->
                <div class='loading'>
                    <img src='https://i.sstatic.net/fLkAW.gif' alt=''/>
                </div>

            </div>

        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.manage_team|as_crispy_field }}
            </div>
        </div>

        {{ form.position_team|as_crispy_field }}

<!--        <div class="row">-->
<!--            <div class="col-md-4">-->
        {{ form.summary_goal|as_crispy_field }}
<!--            </div>-->
<!--        </div>-->
<!--        <div class="row">-->
<!--            <div class="col-md-4">-->
        {{ form.responsibility|as_crispy_field }}
<!--            </div>-->
<!--        </div>-->
        <br>
        <div class="row">
            <div class="col-md-4">
                {{ form.formation|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.formation_desired|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.specialization|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.areas|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.areas_desired|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.area_specialization|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.areas2|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.areas_desired2|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.area_specialization2|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.areas3|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.areas_desired3|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.area_specialization3|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.areas4|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.areas_desired4|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.area_specialization4|as_crispy_field }}
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-4">
                {{ form.idioma|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.idioma2|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.idioma3|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.proficiency|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.proficiency2|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.proficiency3|as_crispy_field }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{ form.qualification|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.qualification2|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.qualification3|as_crispy_field }}
            </div>
        </div>
        <br>
<!--        <div class="row">-->
<!--            <div class="col-md-4">-->
        {{ form.knowledge|as_crispy_field }}
<!--            </div>-->
<!--        </div>-->
<!--        <div class="row">-->
<!--            <div class="col-md-4">-->
        {{ form.information|as_crispy_field }}
<!--            </div>-->
<!--        </div>-->
        <div class="row">
            <div class="col-md-4">
                {{ form.experience|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.cbo|as_crispy_field }}
            </div>
            <div class="col-md-4">
                {{ form.is_active|as_crispy_field }}
            </div>
<!--            <div class="col-md-4">-->
<!--                {{ form.approver|as_crispy_field }}-->
<!--            </div>-->
<!--            <div class="col-md-4">-->
<!--                {{ form.date_approval|as_crispy_field }}-->
<!--            </div>-->
        </div>
<!--        <br>-->
<!--        <div class="row">-->

<!--            <div class="col-md-4">-->
<!--                {{ form.cbo|as_crispy_field }}-->
<!--            </div>-->
<!--&lt;!&ndash;            <div class="col-md-4">&ndash;&gt;-->
<!--&lt;!&ndash;                {{ form.user_id|as_crispy_field }}&ndash;&gt;-->
<!--&lt;!&ndash;            </div>&ndash;&gt;-->
<!--            <div class="col-md-4">-->
<!--                {{ form.is_active|as_crispy_field }}-->
<!--            </div>-->
<!--        </div>-->
    </font>

    <br>

    <button type="submit" class="btn btn-success">Salvar</button>
    {% if descricao.id != null %}
        <a href="{% url 'descricao:descricao-aprovacao' descricao.id %}"><button type="button" class="btn btn-success">Finalizar/Aprovação</button></a>
    {% else %}
<!--        <button type="submit" class="btn btn-success" value="aprovado">Finalizar/Aprovação</button>-->
        <input class="btn btn-primary" type="submit" name="submit" value="Aprovar" />
    {% endif %}

    <a href="{% url 'descricao:descricao-list' %}"><button type="button" class="btn btn-secondary">Cancelar</button></a>

</form>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    $("#id_board").change(function () {
      var url = $("#descricaoForm").attr("data-areas-url");  // get the url of the `load_cities` view
      var boardId = $(this).val();  // get the selected country ID from the HTML input

      $.ajax({                       // initialize an AJAX request
        url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'board': boardId       // add the country id to the GET parameters
        },
        success: function (data) {   // `data` is the return of the `load_cities` view function
          $("#id_area").html(data);  // replace the contents of the city input with the data that came from the server
        }
      });

    });

    $("#id_family").change(function () {
      var url = $("#descricaoForm").attr("data-sub_familias-url");  // get the url of the `load_cities` view
      var familyId = $(this).val();  // get the selected country ID from the HTML input

      $.ajax({                       // initialize an AJAX request
        url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'family': familyId       // add the country id to the GET parameters
        },
        success: function (data) {   // `data` is the return of the `load_cities` view function
          $("#id_sub_familia").html(data);  // replace the contents of the city input with the data that came from the server
        }
      });

    });

    function DescricaoIA() {                                   // Mostra descrição da IA
        var url = $("#descricaoForm").attr("data-ia-url");
        var title = $("#id_title").val();                        // Titulo
        var familyid = $("#id_family").val();                    // Familia
        var sub_familiaoid = $("#id_sub_familia").val();         // Sub Familia
        var levelid = $("#id_level").val();                      // Nivel
        var sectorid = $("#id_sector").val();                    // Setor
        var loading = $('.loading');                             // Ampulheta


        if ((title.trim().length == 0) || (familyid.trim().length == 0) || (sub_familiaoid.trim().length == 0) || (levelid.trim().length == 0) || (sectorid.trim().length == 0)) {
            alert('Para usar a IA, os campos: Título do Cargo, Família, Sub Família, Nivel do Cargo e Setor de Atuação devem ser preenchidos.');
            return false;

        }

        $.ajax({                       // initialize an AJAX request
            url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
            data: {
              'title': title,      // add the country id to the GET parameters
              'family': familyid,        // add the country id to the GET parameters,      // add the country id to the GET parameters
              'sub_familia': sub_familiaoid,        // add the country id to the GET parameters,      // add the country id to the GET parameters
              'level': levelid,        // add the country id to the GET parameters,      // add the country id to the GET parameters
              'sector': sectorid,        // add the country id to the GET parameters,      // add the country id to the GET parameters
            },

            beforeSend: function(){
                loading.css('visibility', 'visible'); // exibe o div
            },

            complete: function(){
                loading.css('visibility', 'hidden'); // esconde o div
            },

            success: function (data) {   // `data` is the return of the `load_cities` view function

<!--                alert(data);-->
                data = data.split("|");

<!--                alert(data[3]);-->

                $('#summary_goal').html(data[0]);
                $('#responsibility').html(data[1]);
                $('#information').html(data[2]);

<!--                $("#id_manage_team").html(data[3]);-->
                $("#id_manage_team").val(Number(data[3]));
                $('#id_formation_desired').val(Number(data[4]));
                $('#id_specialization').val(Number(data[5]));
                $('#id_experience').val(Number(data[6]));
                $("#id_areas_desired").val(Number(data[7]));
                $("#id_qualification").val(Number(data[8]));

            }

       });
    }

</script>
{% endblock %}
